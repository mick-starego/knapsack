(()=>{function t(t,e){return Math.floor(t/e)}function e(t,e,r){const o=t.map((t,e)=>({...calculatedItems[e],quantity:t,totalPrice:calculatedItems[e].unitPrice*t})).filter(t=>t.quantity);o.sort((t,e)=>t.category===e.category?e.totalPrice-t.totalPrice:t.category.localeCompare(e.category));const n=o.reduce((t,e)=>t+e.totalPrice,0),a=n*r/100;return[...o,{name:"Sales Tax "+r.toFixed(2)+"%",totalPrice:a},{name:"Total",totalPrice:n+a}]}function r(t,e,r){const o=t.length/e.length,n=[...new Set(e.map(t=>t.category))].map(e=>t.filter(t=>t.category===e)),a=n.map(t=>t.reduce((t,e)=>t+e.totalPrice,0)),i=Math.min(...a),c=1-(Math.max(...a)-i)/r,s=t.reduce((t,e)=>t+e.quantity,0),l=n.map(t=>t.reduce((t,e)=>t+e.quantity,0)),u=Math.min(...l);return 3*o+2*c+(1-(Math.max(...l)-u)/s)}self.onmessage=function(o){let n;try{n=function(o,n,a){const i=[...a].map(t=>({...t,integerPrice:Math.round(100*t.unitPrice)})).sort((t,e)=>t.integerPrice-e.integerPrice),c=100*o,s=(c-.5)/(1+n/100),l=(c+.5)/(1+n/100);if(Math.ceil(s)>=l)throw new Error(`Target ${o} is not possible for tax ${n.toFixed(2)}%`);const u=Math.ceil(s),f=[],g=new Array(u+1).fill(!1);g[0]=!0,f.push(g);for(let e=1;e<=i.length;e++){const r=new Array(u+1).fill(!1);for(let o=0;o<=u;o++){const n=i[e-1];let a=0;for(;a<=t(o,n.integerPrice);){const t=o-a*n.integerPrice;if(f[e-1][t]){r[o]=!0;break}a++}}f.push(r)}const[h,m]=[i.length,u];if(!f[h][m])return{data:[],numSolutions:0};let P;const d=Date.now(),p=[[h,m,[]]];for(;p.length;){const[o,a,c]=p.pop(),s=i[o-1];if(0===o&&0===a){const t=e(c,0,n),o=r(t,i,u);o>P[0].score&&(P.length>=25&&P.shift(),P.push({score:o,solution:t}),P.sort((t,e)=>t.score-e.score)),totalSolutions++;continue}const l=Date.now()-d;if(l>1e4)break;if(l>5e3&&Math.random()<.2)continue;let g=0;for(;g<=t(a,s.integerPrice);){const t=a-g*s.integerPrice;f[o-1][t]&&p.push([o-1,t,[g,...c]]),g++}}return{data:P,numSolutions:0}}(o.data.target,o.data.tax,o.data.itemList)}catch(t){n={error:t.message}}self.postMessage(n)}})();